{
id: "maggot",
prototype: ["ant"],
hitpoints: 20,

solid_area: [2,10,25,24],
platform_area: [2,10,25,11],
solid_dimensions: [],

editor_info: {
	category: "enemies, cave",
},


properties: {
	points_value: "3",
	acquirable_item_drop_value: "2",
	material_sound: "'bug'",
	
	title: "~White Maggot~",
	description: "~Maggots live underground, eating plants and other, smaller insects.~",
	taste: "~These make a tasty snack.~",

	_wiggle_count: { type: "int", default: 3 },
	custom_default_anim: "string|null :: if(not _preexisting_object, 'emerge')"
},


events: {
#-------------------------- animation control --------------------------#
	end_anim: "if((not animation in ['wiggle', 'emerge', 'fall', 'land']), proto_event('ant', 'end_anim'))",

	"+end_emerge_anim": "set(animation, 'wiggle')",

	"+end_wiggle_anim": "	[
							set(_wiggle_count, _wiggle_count-1),
							if(_wiggle_count <= 0,
								set(animation, 'fall'),
								set(animation, 'wiggle')
							),
							sound('maggot-wiggle.wav')
						]",

	"+end_land_anim": "set(animation, 'stand')",


#-------------------------- physics --------------------------#
	collide_feet: "	if(animation = 'fall' and
						if(arg.collide_with != null,
							(not arg.collide_with.type in ['maggot_white','maggot_grey']),
							true
						),
						[
							sound('maggot-land.wav'),
							set(animation, 'land')
						],
						proto_event('ant', 'collide_feet')
					)",
					
	"+bounced_on": "me.force_death()",

	solidity_fail: "me.force_death()",

#-------------------------- cosmetics --------------------------#
	"+scrunch":"sound('maggot-scrunch'+1d5+'.wav', volume) where volume = lib.math.constrain(0, 200.0/lib.math.length(self, level.player),1.0)",
	"+stretch":"sound('maggot-stretch'+1d7+'.wav', volume) where volume = lib.math.constrain(0, 200.0/lib.math.length(self, level.player),1.0)",
},


animation: [
	{
		"@base": true,
		body_area: ["solid","all"],
		image: "enemies/maggot-white.png",
		rotate_on_slope: true,
		pad: 3,
		accel_x: 0,
		accel_y: 80,
	},
	{
		id: "emerge",
		rect: [2,95,29,122],
		frames: 3,
		frames_per_row: 3,
		duration: 10,
		attack_area: [0,18,27,26],
		solid_area: [2,30,25,44],
		accel_y: 0,
	},
	{
		id: "wiggle",
		rect: [2,126,29,153],
		frames: 3,
		duration: 6,
		attack_area: [0,18,27,26],
		frames_per_row: 3,
		reverse: true,
		solid_area: [2,30,25,44],
		accel_y: 0,
	},
	{
		id: "stand",
		rect: [2,2,29,29],
		frames: 1,
		duration: 6,
		attack_area: [21,18,27,26],
	},
	{
		id: "walk",
		attack_area: [21,18,27,26],
		rect: [2,2,29,29],
		frames: 4,
		events: "0:scrunch,14:stretch",
		duration: 7,
		accel_x: 100,
	},
	{
		id: "spring",
		rect: [2,33,29,60],
		frames: 1,
		duration: 4,
	},
	{
		id: "turn",
		rect: [2,64,29,91],
		frames: 3,
		duration: 4,
		attack_area: [0,18,27,26],
	},
	{
		id: "hurt",
		rect: [95,64,122,91],
		frames: 1,
		duration: 18,
	},
	{
		id: "land",
		rect: [2,157,29,184],
		frames: 3,
		duration: 4,
		attack_area: [0,18,27,26],
		frames_per_row: 3,
	},
	{
		id: "fall",
		rect: [33,126,60,153],
		frames: 1,
		duration: 40,
		attack_area: "all",
		frames_per_row: 1,
	},
],

}
